define(["jquery", "core/tree"], function (i) { return { processingDocs: [], addPlagiarismCtrlButtons: function () { var r = this; i(document).on("click", ".update_report", function () { var e = i(i(".typeid", i(this).parent())[0]).text(); return r.processingDocs[e] || (r.processingDocs[e] = 1, i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: { action: "update_report", typeid: e, sesskey: M.cfg.sesskey }, success: function (s) { r.setVerfyResult(s, e) }, error: function (s, t, a) { console.log(a), console.log(e), console.log(s), console.log(t) } })), !1 }), i(document).on("click", ".advacheck-checkbtn", function () { var t = i(this).attr("class").split(/\s+/)[1]; if (r.processingDocs[t]) return !1; r.processingDocs[t] = 1; var e, s = i(i(".advacheck-data." + t + " .doctype")[0]).text(), a = i(i(".advacheck-data." + t + " .courseid")[0]).text(); return e = 1 != s ? { action: "checktext", typeid: t, doctype: s, courseid: a, assignment: i(i(".advacheck-data." + t + " .assignment")[0]).text(), discussion: i(i(".advacheck-data." + t + " .discussion")[0]).text(), userid: i(i(".advacheck-data." + t + " .userid")[0]).text(), content: i(i(".advacheck-data." + t + " .content")[0]).text(), sesskey: M.cfg.sesskey } : { typeid: t, action: "checkfile", courseid: a, sesskey: M.cfg.sesskey }, i(".advacheck-checkbtn." + t).hide(), i(".advacheck-loader." + t).removeClass("advacheck-hidden"), i(".advacheck-data.advacheck-green.checking." + t).css("display", "inline-grid"), i(".advacheck-data.advacheck-green.checking." + t).show(), i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", sesskey: M.cfg.sesskey, method: "POST", dataType: "html", cache: !1, data: e, success: function (s) { r.setVerfyResult(s, t) }, error: function (s, t, a) { console.log(a), console.log(e), console.log(s), console.log(t) } }), !1 }) }, verifyStatus: [], updateVerifyResult: function (e, t) { i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: { action: "update_report", typeid: e, sesskey: M.cfg.sesskey }, success: function (s) { t.setVerfyResult(s, e) }, error: function (s, t, a) { console.log(a), console.log(e), console.log(s), console.log(t) } }) }, setVerfyResult: function (t, a) { try { (t = JSON.parse(t)).check_studs && ("none" === t.check_studs ? i(".stud_check-" + a).hide() : i(".stud_check-" + a).html(t.check_studs)), 4 == t.status || 5 == t.status ? (i(".advacheck-loader." + a).addClass("advacheck-hidden"), i(".advacheck-data.advacheck-green.checking." + a).hide(), i("check_notice." + a).hide(), t.docid && i(".advacheck-data." + a + " .docid").html(t.docid), t.plagiarism && i("span.plagiarism-" + a).html(t.plagiarism), t.selfcite && i("span.selfcite-" + a).html(t.selfcite), t.legal && i("span.legal-" + a).html(t.legal), t.originality && i("span.originality-" + a).html(t.originality), t.issuspicious && t.report && (i("span.advacheck-suspicious." + a).attr("class", "span.advacheck-suspicious." + a + " advacheck-suspiciouson"), i("span.advacheck-suspicious_lnk." + a).attr("href", t.report), i("span.advacheck-suspicious_lnk." + a).attr("class", "span.advacheck-suspicious_lnk." + a + " advacheck-suspiciouson")), t.report && i(".advacheck-report-" + a).attr("href", t.report).show(), i(".advacheck_help." + a).show(), t.class && i(".advacheck-plagiarismresult." + a).attr("class", "advacheck-plagiarismresult " + a + " " + t.class), this.verifyStatus[a] && clearInterval(this.verifyStatus[a]), this.processingDocs[a] && delete this.processingDocs[a]) : t.error ? (i(".advacheck-loader." + a).addClass("advacheck-hidden"), i(".advacheck-data.advacheck-green.checking." + a).hide(), i(".advacheck." + a).addClass("advacheck-hidden"), i(".advacheck-plagiarismresult." + a).attr("class", "advacheck-plagiarismresult " + a + " advacheck-red"), i(".advacheck-plagiarismresult." + a).html(t.error), this.verifyStatus[a] && clearInterval(this.verifyStatus[a]), this.processingDocs[a] && delete this.processingDocs[a]) : this.verifyStatus[a] || (this.verifyStatus[a] = setInterval(this.updateVerifyResult, 6e4, a, this)) } catch (s) { i(".advacheck-loader." + a).addClass("advacheck-hidden"), i(".advacheck-data.advacheck-green.checking." + a).hide(), i(".advacheck." + a).addClass("advacheck-hidden"), i(".advacheck-plagiarismresult." + a).addClass("class", "advacheck-plagiarismresult " + a + " " + t.class), i(".advacheck-plagiarismresult." + a).html(t.error), console.log(s.message), console.log(t), this.verifyStatus[a] && clearInterval(this.verifyStatus[a]), this.processingDocs[a] && delete this.processingDocs[a] } return !1 }, checkTarif: function () { i(document).on("click", ".test-tarif", function () { var s = i("#id_login").val(), t = i("#id_password").val(), a = i("#id_soap_wsdl").val(), e = i("#id_uri").val(); i("#id_tarif_info").show(); var r = { action: "checktarif", login: s, password: t, soap_wsdl: a, uri: e, sesskey: M.cfg.sesskey }; return i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: r, success: function (s) { (s = JSON.parse(s)) && (i("#id_tarif_info").html(s), i("#id_tarif_info").show()) }, error: function (s, t, a) { console.log(a), console.log(r), console.log(s), console.log(t) } }), !1 }) }, changeMode: function () { i(".changetype").change(function () { var s, t = i(this).attr("name"), a = null, e = null; "disp_notices" === t || "check_stud_lim" === t || "works_types" === t ? (a = i(this).val(), e = (s = i(this).attr("class").split(" "))[s.length - 1]) : (e = i(this).val(), a = Number(i(this).is(":checked"))), i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", data: { action: "changetype", cm: e, doctype: t, value: a, sesskey: M.cfg.sesskey } }) }), i(".changemode").change(function () { var s = i(this).attr("name"), t = i(this).val(); i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", data: { action: "changeMode", cm: s, mode: t, sesskey: M.cfg.sesskey } }) }) } } });