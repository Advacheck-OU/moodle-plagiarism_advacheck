define(["jquery", "core/tree"], function (a) { return { processingDocs: [], addPlagiarismCtrlButtons: function () { var s = this; a(document).on("click", ".update_report", function () { var t = a(a(".typeid", a(this).parent())[0]).text(); return !s.processingDocs[t] && (s.processingDocs[t] = 1, a.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: { action: "update_report", typeid: t, sesskey: M.cfg.sesskey }, success: function (a) { s.setVerfyResult(a, t) }, error: function (a, s, e) { console.log(e), console.log(t), console.log(a), console.log(s) } }), !1) }), a(document).on("click", ".advacheck-checkbtn", function () { var t = a(this).attr("class").split(/\s+/)[1]; if (s.processingDocs[t]) return !1; s.processingDocs[t] = 1; var e = a(a(".advacheck-data." + t + " .doctype")[0]).text(), r = a(a(".advacheck-data." + t + " .courseid")[0]).text(); if (1 != e) var i = { action: "checktext", typeid: t, doctype: e, courseid: r, assignment: a(a(".advacheck-data." + t + " .assignment")[0]).text(), discussion: a(a(".advacheck-data." + t + " .discussion")[0]).text(), userid: a(a(".advacheck-data." + t + " .userid")[0]).text(), content: a(a(".advacheck-data." + t + " .content")[0]).text(), sesskey: M.cfg.sesskey }; else var i = { typeid: t, action: "checkfile", courseid: r, sesskey: M.cfg.sesskey }; return a(".advacheck-checkbtn." + t).hide(), a(".advacheck-gray.checking." + t).removeClass("advacheck-hidden"), a(".advacheck-loader." + t).removeClass("advacheck-hidden"), a.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", sesskey: M.cfg.sesskey, method: "POST", dataType: "html", cache: !1, data: i, success: function (a) { s.setVerfyResult(a, t) }, error: function (a, s, t) { console.log(t), console.log(i), console.log(a), console.log(s) } }), !1 }) }, verifyStatus: [], updateVerifyResult: function (s, t) { a.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: { action: "update_report", typeid: s, sesskey: M.cfg.sesskey }, success: function (a) { t.setVerfyResult(a, s) }, error: function (a, t, e) { console.log(e), console.log(s), console.log(a), console.log(t) } }) }, setVerfyResult: function (s, t) { try { if ((s = JSON.parse(s)).check_studs && ("none" === s.check_studs ? a(".stud_check-" + t).hide() : a(".stud_check-" + t).html(s.check_studs)), 4 == s.status || 5 == s.status) { if (a(".advacheck-loader." + t).addClass("advacheck-hidden"), a(".advacheck-gray.checking." + t).addClass("advacheck-hidden"), a(".check_notice." + t).addClass("advacheck-hidden"), s.docid && a(".advacheck-data." + t + " .docid").html(s.docid), s.plagiarism && a("span.plagiarism-" + t).html(s.plagiarism), s.scoreai ? a("span.scoreai-" + t).html(s.scoreai) : (console.log("remove scoreai bar"), console.log(a("span.scoreai_bar-" + t).html()), a("span.scoreai_bar-" + t).html("")), s.issuspicious && s.report && (a("span.advacheck-suspicious." + t).attr("class", "advacheck-suspicious " + t + " advacheck-suspiciouson"), a("a.advacheck-suspicious_lnk." + t).attr("href", s.report)), s.report) { var e = a(".advacheck-plagiarismresult." + t).attr("title"); e = (e = (e = (e = (e = e.replace("-%", s.plagiarism)).replace("-%", s.selfcite)).replace("-%", s.originality)).replace("-%", s.legal)).replace("-%", s.scoreai); var e = a(".advacheck-plagiarismresult." + t).attr("title", e); a(".advacheck-report-" + t).attr("href", s.report).show() } a(".advacheck-clear." + t).removeClass("advacheck-hidden"), s.class && (a(".advacheck-plagiarismresult." + t).attr("class", "badge badge-pill advacheck-plagiarismresult " + t + " " + s.class), a(".fa-solid.fa-arrow-right." + t).attr("class", "fa-solid fa-arrow-right " + t + " " + s.iconclass), a(".invisibleicon." + t).attr("class", "fa-solid  " + s.icontype + " " + t + " " + s.iconclass), a(".fa-solid.fa-circle-check." + t).attr("class", "fa-solid fa-circle-check " + t + " " + s.iconclass), a(".fa-solid.fa-circle-exclamation." + t).attr("class", "fa-solid fa-circle-exclamation " + t + " " + s.iconclass)), this.verifyStatus[t] && clearInterval(this.verifyStatus[t]), this.processingDocs[t] && delete this.processingDocs[t] } else s.error ? (a(".advacheck-loader." + t).addClass("advacheck-hidden"), a(".advacheck-data.badge.badge-pill.advacheck-gray.checking." + t).hide(), a(".advacheck." + t).addClass("advacheck-hidden"), a(".advacheck-plagiarismresult." + t).attr("class", "badge badge-pill advacheck-plagiarismresult " + t + " advacheck-clear"), a(".advacheck-plagiarismresult." + t).html(s.error), this.verifyStatus[t] && clearInterval(this.verifyStatus[t]), this.processingDocs[t] && delete this.processingDocs[t]) : this.verifyStatus[t] || (this.verifyStatus[t] = setInterval(this.updateVerifyResult, 6e4, t, this)) } catch (r) { a(".advacheck-loader." + t).addClass("advacheck-hidden"), a(".advacheck-data.badge.badge-pill.advacheck-gray.checking." + t).hide(), a(".advacheck." + t).addClass("advacheck-hidden"), a(".advacheck-plagiarismresult." + t).addClass("class", "badge badge-pill advacheck-plagiarismresult " + t + " " + s.class), a(".advacheck-plagiarismresult." + t).html(s.error), console.log(r.message), console.log(s), this.verifyStatus[t] && clearInterval(this.verifyStatus[t]), this.processingDocs[t] && delete this.processingDocs[t] } return !1 }, checkTarif: function () { a(document).on("click", ".test-tarif", function () { var s = a("#id_login").val(), t = a("#id_password").val(), e = a("#id_soap_wsdl").val(), r = a("#id_uri").val(); a("#id_tarif_info").show(); var i = { action: "checktarif", login: s, password: t, soap_wsdl: e, uri: r, sesskey: M.cfg.sesskey }; return a.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: i, success: function (s) { (s = JSON.parse(s)) && (a("#id_tarif_info").html(s), a("#id_tarif_info").show()) }, error: function (a, s, t) { console.log(t), console.log(i), console.log(a), console.log(s) } }), !1 }) }, changeMode: function () { a(".changetype").change(function () { var s = a(this).attr("name"), t = null, e = null; if ("disp_notices" === s || "check_stud_lim" === s || "works_types" === s) { t = a(this).val(); var r = a(this).attr("class").split(" "); e = r[r.length - 1] } else e = a(this).val(), t = Number(a(this).is(":checked")); a.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", data: { action: "changetype", cm: e, doctype: s, value: t, sesskey: M.cfg.sesskey } }) }), a(".changemode").change(function () { var s = a(this).attr("name"), t = a(this).val(); a.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", data: { action: "changeMode", cm: s, mode: t, sesskey: M.cfg.sesskey } }) }) } } });