define(["jquery", "core/tree"], function (i) { return { processingDocs: [], addPlagiarismCtrlButtons: function () { var r = this; i(document).on("click", ".update_report", function () { var e = i(i(".typeid", i(this).parent())[0]).text(); return r.processingDocs[e] || (r.processingDocs[e] = 1, i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: { action: "update_report", typeid: e, sesskey: M.cfg.sesskey }, success: function (t) { r.setVerfyResult(t, e) }, error: function (t, s, a) { console.log(a), console.log(e), console.log(t), console.log(s) } })), !1 }), i(document).on("click", ".advacheck-checkbtn", function () { var s = i(this).attr("class").split(/\s+/)[1]; if (r.processingDocs[s]) return !1; r.processingDocs[s] = 1; var e, t = i(i(".advacheck-data." + s + " .doctype")[0]).text(), a = i(i(".advacheck-data." + s + " .courseid")[0]).text(); return e = 1 != t ? { action: "checktext", typeid: s, doctype: t, courseid: a, assignment: i(i(".advacheck-data." + s + " .assignment")[0]).text(), discussion: i(i(".advacheck-data." + s + " .discussion")[0]).text(), userid: i(i(".advacheck-data." + s + " .userid")[0]).text(), content: i(i(".advacheck-data." + s + " .content")[0]).text(), sesskey: M.cfg.sesskey } : { typeid: s, action: "checkfile", courseid: a, sesskey: M.cfg.sesskey }, i(".advacheck-checkbtn." + s).hide(), i(".advacheck-loader." + s).removeClass("advacheck-hidden"), i(".advacheck-data.advacheck-gray.checking." + s).css("display", "inline-grid"), i(".advacheck-data.advacheck-gray.checking." + s).show(), i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", sesskey: M.cfg.sesskey, method: "POST", dataType: "html", cache: !1, data: e, success: function (t) { r.setVerfyResult(t, s) }, error: function (t, s, a) { console.log(a), console.log(e), console.log(t), console.log(s) } }), !1 }) }, verifyStatus: [], updateVerifyResult: function (e, s) { i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: { action: "update_report", typeid: e, sesskey: M.cfg.sesskey }, success: function (t) { s.setVerfyResult(t, e) }, error: function (t, s, a) { console.log(a), console.log(e), console.log(t), console.log(s) } }) }, setVerfyResult: function (s, a) { try { var t; (s = JSON.parse(s)).check_studs && ("none" === s.check_studs ? i(".stud_check-" + a).hide() : i(".stud_check-" + a).html(s.check_studs)), 4 == s.status || 5 == s.status ? (i(".advacheck-loader." + a).addClass("advacheck-hidden"), i(".advacheck-data.advacheck-gray.checking." + a).hide(), i("check_notice." + a).hide(), s.docid && i(".advacheck-data." + a + " .docid").html(s.docid), s.plagiarism && i("span.plagiarism-" + a).html(s.plagiarism), s.selfcite && i("span.selfcite-" + a).html(s.selfcite), s.legal && i("span.legal-" + a).html(s.legal), s.originality && i("span.originality-" + a).html(s.originality), s.issuspicious && s.report && (i("span.advacheck-suspicious." + a).attr("class", "span.advacheck-suspicious." + a + " advacheck-suspiciouson"), i("span.advacheck-suspicious_lnk." + a).attr("href", s.report), i("span.advacheck-suspicious_lnk." + a).attr("class", "span.advacheck-suspicious_lnk." + a + " advacheck-suspiciouson")), s.report && (t = (t = (t = (t = (t = i(".advacheck-plagiarismresult." + a).attr("title")).replace("{$a->plagiarism}%", s.plagiarism)).replace("{$a->selfcite}%", s.selfcite)).replace("{$a->originality}%", s.originality)).replace("{$a->legal}%", s.legal), t = i(".advacheck-plagiarismresult." + a).attr("title", t), i(".advacheck-report-" + a).attr("href", s.report).show()), i(".advacheck_help." + a).show(), s.class && i(".advacheck-plagiarismresult." + a).attr("class", "advacheck-plagiarismresult " + a + " " + s.class), this.verifyStatus[a] && clearInterval(this.verifyStatus[a]), this.processingDocs[a] && delete this.processingDocs[a]) : s.error ? (i(".advacheck-loader." + a).addClass("advacheck-hidden"), i(".advacheck-data.advacheck-gray.checking." + a).hide(), i(".advacheck." + a).addClass("advacheck-hidden"), i(".advacheck-plagiarismresult." + a).attr("class", "advacheck-plagiarismresult " + a + " advacheck-red"), i(".advacheck-plagiarismresult." + a).html(s.error), this.verifyStatus[a] && clearInterval(this.verifyStatus[a]), this.processingDocs[a] && delete this.processingDocs[a]) : this.verifyStatus[a] || (this.verifyStatus[a] = setInterval(this.updateVerifyResult, 6e4, a, this)) } catch (t) { i(".advacheck-loader." + a).addClass("advacheck-hidden"), i(".advacheck-data.advacheck-gray.checking." + a).hide(), i(".advacheck." + a).addClass("advacheck-hidden"), i(".advacheck-plagiarismresult." + a).addClass("class", "advacheck-plagiarismresult " + a + " " + s.class), i(".advacheck-plagiarismresult." + a).html(s.error), console.log(t.message), console.log(s), this.verifyStatus[a] && clearInterval(this.verifyStatus[a]), this.processingDocs[a] && delete this.processingDocs[a] } return !1 }, checkTarif: function () { i(document).on("click", ".test-tarif", function () { var t = i("#id_login").val(), s = i("#id_password").val(), a = i("#id_soap_wsdl").val(), e = i("#id_uri").val(); i("#id_tarif_info").show(); var r = { action: "checktarif", login: t, password: s, soap_wsdl: a, uri: e, sesskey: M.cfg.sesskey }; return i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: r, success: function (t) { (t = JSON.parse(t)) && (i("#id_tarif_info").html(t), i("#id_tarif_info").show()) }, error: function (t, s, a) { console.log(a), console.log(r), console.log(t), console.log(s) } }), !1 }) }, changeMode: function () { i(".changetype").change(function () { var t, s = i(this).attr("name"), a = null, e = null; "disp_notices" === s || "check_stud_lim" === s || "works_types" === s ? (a = i(this).val(), e = (t = i(this).attr("class").split(" "))[t.length - 1]) : (e = i(this).val(), a = Number(i(this).is(":checked"))), i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", data: { action: "changetype", cm: e, doctype: s, value: a, sesskey: M.cfg.sesskey } }) }), i(".changemode").change(function () { var t = i(this).attr("name"), s = i(this).val(); i.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", data: { action: "changeMode", cm: t, mode: s, sesskey: M.cfg.sesskey } }) }) } } });