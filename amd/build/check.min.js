define(["jquery", "core/tree"], function (o) { return { processingDocs: [], addPlagiarismCtrlButtons: function () { var r = this; o(document).on("click", ".update_report", function () { var a = o(o(".typeid", o(this).parent())[0]).text(); return r.processingDocs[a] || (r.processingDocs[a] = 1, o.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: { action: "update_report", typeid: a, sesskey: M.cfg.sesskey }, success: function (s) { r.setVerfyResult(s, a) }, error: function (s, t, e) { console.log(e), console.log(a), console.log(s), console.log(t) } })), !1 }), o(document).on("click", ".advacheck-checkbtn", function () { var t = o(this).attr("class").split(/\s+/)[1]; if (r.processingDocs[t]) return !1; r.processingDocs[t] = 1; var a, s = o(o(".advacheck-data." + t + " .doctype")[0]).text(), e = o(o(".advacheck-data." + t + " .courseid")[0]).text(); return a = 1 != s ? { action: "checktext", typeid: t, doctype: s, courseid: e, assignment: o(o(".advacheck-data." + t + " .assignment")[0]).text(), discussion: o(o(".advacheck-data." + t + " .discussion")[0]).text(), userid: o(o(".advacheck-data." + t + " .userid")[0]).text(), content: o(o(".advacheck-data." + t + " .content")[0]).text(), sesskey: M.cfg.sesskey } : { typeid: t, action: "checkfile", courseid: e, sesskey: M.cfg.sesskey }, o(".advacheck-checkbtn." + t).hide(), o(".advacheck-loader." + t).removeClass("advacheck-hidden"), o(".advacheck-data.advacheck-green.checking." + t).css("display", "inline-grid"), o(".advacheck-data.advacheck-green.checking." + t).show(), o.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", sesskey: M.cfg.sesskey, method: "POST", dataType: "html", cache: !1, data: a, success: function (s) { r.setVerfyResult(s, t) }, error: function (s, t, e) { console.log(e), console.log(a), console.log(s), console.log(t) } }), !1 }) }, verifyStatus: [], updateVerifyResult: function (a, t) { o.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: { action: "update_report", typeid: a, sesskey: M.cfg.sesskey }, success: function (s) { t.setVerfyResult(s, a) }, error: function (s, t, e) { console.log(e), console.log(a), console.log(s), console.log(t) } }) }, setVerfyResult: function (t, e) { try { (t = JSON.parse(t)).check_studs && ("none" === t.check_studs ? o(".stud_check-" + e).hide() : o(".stud_check-" + e).html(t.check_studs)), 4 == t.status || 5 == t.status ? (o(".advacheck-loader." + e).addClass("advacheck-hidden"), o(".advacheck-data.advacheck-green.checking." + e).hide(), o(".check_notice-" + e).hide(), t.docid && o(".advacheck-data." + e + " .docid").html(t.docid), t.plagiarism && o("span.plagiarism-" + e).html(t.plagiarism), t.selfcite && o("span.selfcite-" + e).html(t.selfcite), t.legal && o("span.legal-" + e).html(t.legal), t.originality && o("span.originality-" + e).html(t.originality), t.issuspicious && t.report && (o("span.advacheck-suspicious-" + e).css("display", "inline-block"), o("span.advacheck-suspicious-" + e).attr("href", t.report).show()), t.report && (o(".advacheck-report-" + e).attr("href", t.report).show(), t.issuspicious && (o("span." + e + ".advacheck-suspicious").css("display", "inline-block"), o("a." + e + ".advacheck-suspicious_lnk").attr("href", t.report).show())), o(".advacheck_help." + e).show(), t.class && o(".advacheck." + e).attr("class", "advacheck " + e + " " + t.class), o(".advacheck." + e).show(), this.verifyStatus[e] && clearInterval(this.verifyStatus[e]), this.processingDocs[e] && delete this.processingDocs[e]) : t.error ? (o(".advacheck." + e).attr("class", "advacheck-" + e + " " + t.class), o(".advacheck." + e).html(t.error), this.verifyStatus[e] && clearInterval(this.verifyStatus[e]), this.processingDocs[e] && delete this.processingDocs[e]) : this.verifyStatus[e] || (this.verifyStatus[e] = setInterval(this.updateVerifyResult, 6e4, e, this)) } catch (s) { o(".advacheck-checkbtn." + e).show(), o(".advacheck-loader." + e).addClass("advacheck-hidden"), o(".advacheck." + e).html(t.error).show(), console.log(s.message), console.log(t), this.verifyStatus[e] && clearInterval(this.verifyStatus[e]), this.processingDocs[e] && delete this.processingDocs[e] } return !1 }, checkTarif: function () { o(document).on("click", ".test-tarif", function () { var s = o("#id_login").val(), t = o("#id_password").val(), e = o("#id_soap_wsdl").val(), a = o("#id_uri").val(); o("#id_tarif_info").show(); var r = { action: "checktarif", login: s, password: t, soap_wsdl: e, uri: a, sesskey: M.cfg.sesskey }; return o.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", dataType: "html", data: r, success: function (s) { (s = JSON.parse(s)).message && (o("#id_tarif_info").html(s.message), o("#id_tarif_info").show()) }, error: function (s, t, e) { console.log(e), console.log(r), console.log(s), console.log(t) } }), !1 }) }, changeMode: function () { o(".changetype").change(function () { var s, t = o(this).attr("name"), e = null, a = null; "disp_notices" === t || "check_stud_lim" === t || "works_types" === t ? (e = o(this).val(), a = (s = o(this).attr("class").split(" "))[s.length - 1]) : (a = o(this).val(), e = Number(o(this).is(":checked"))), o.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", data: { action: "changetype", cm: a, doctype: t, value: e, sesskey: M.cfg.sesskey } }) }), o(".changemode").change(function () { var s = o(this).attr("name"), t = o(this).val(); o.ajax({ url: M.cfg.wwwroot + "/plagiarism/advacheck/ajax.php", method: "POST", data: { action: "changeMode", cm: s, mode: t, sesskey: M.cfg.sesskey } }) }) } } });